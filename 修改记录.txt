修改要求：解决 groupby 操作的错误

修改详情：
1. 移除了不兼容的 groupby().apply() 操作
2. 改用基础的循环和数学计算实现加权平均
3. 简化了代码结构，提高了兼容性
4. 保持了原有的统计功能和输出格式 